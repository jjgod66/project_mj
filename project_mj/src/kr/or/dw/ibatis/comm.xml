<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="comm">
	
	<select id="selectUserCommList" parameterClass="Map" resultClass="commVO">
		SELECT *
		  FROM (
				SELECT *
				  FROM (
				  		SELECT rownum rnum, v1.*
						  FROM (
						  		SELECT *
								  FROM bd_comm
								 WHERE gb_del = 'N'
								 ORDER BY bd_no ASC
						  		) v1
						 WHERE rownum <![CDATA[ <= ]]> #end#
				  		) v2
				 WHERE rnum <![CDATA[ >= ]]> #start#
				) comm
<!-- 		  WHERE user_no = #user_no# -->
	</select>
	
 	<select id="selectCommCount" resultClass="int">
		SELECT COUNT(*) cnt
		  FROM bd_comm
		 WHERE gb_del = 'N'
	</select>
	
	<select id="selectCommView" parameterClass="int" resultClass="commVO">
		SELECT bd_no
			  ,bd_title
			  ,bd_content
			  ,bd_wdt
			  ,bd_hit
			  ,NVL((SELECT SUM(like_cnt)
			  		  FROM bd_comm_like
			  		 WHERE bd_no = b.bd_no), 0) bd_like
			  ,NVL((SELECT COUNT(*)
			  		  FROM bd_comm_re
			  		 WHERE bd_no = b.bd_no), 0) reply_cnt
			  ,b.user_no
			  ,b.user_nick
		  FROM bd_comm b
		  	  ,user_ u
		 WHERE b.user_no = u.user_no
		   AND b.gb_del = 'N'
		   AND bd_no = #bd_no#
	</select> 
	
	<select id="selectReplyList" parameterClass="int" resultClass="replyVO">
		SELECT re_no
			  ,bd_no
			  ,re_content
			  ,re_wdt
			  ,r.user_no
			  ,r.user_nick
			  ,pic_path
		  FROM bd_comm_re r
		  	  ,user_ u
		 WHERE r.user_no = u.user_no
		   AND r.gb_del = 'N'
		   AND bd_no = #bd_no#
		 ORDER BY re_no DESC
	</select>
	
	
	
	<select id="selectUserLike" parameterClass="likeVO" resultClass="int">
		SELECT count(like_cnt) 
		  FROM bd_comm_like
		 WHERE bd_no = #bd_no#
		   AND user_no = #user_no#
	</select>	
	
	
	

</sqlMap>