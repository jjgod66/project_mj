<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="user">

	<select id="getUser_nick" parameterClass="String" resultClass = "String">
		SELECT user_nick FROM user_ WHERE user_nick = #user_nick#
	</select>
	
	<insert id="insertUser" parameterClass="UserVO">
		
		<selectKey keyProperty="user_no" resultClass="int">
			SELECT user_seq.nextval user_no 
			FROM dual
		</selectKey>
		
		INSERT INTO user_ (
							user_no
							,user_email
							,user_pass
							,user_name
							,user_nick
							,auth_cd
							,gb_del
							)
					VALUES (
							#user_no#
							,#user_email#
							,#user_pass#
							,#user_name#
							,#user_nick#
							,'B101'
							,'N'
							)
	</insert>

	<select id="loginUser" parameterClass="String" resultClass="UserVO">
		SELECT * FROM user_ WHERE user_email= #user_email#
	</select>
		
	<select id="selectUserList" parameterClass="Map" resultClass="userVO">

		SELECT user_no
			  ,user_email
			  ,user_nick
			  ,user_sdt
			  ,gb_del
		  FROM (
				SELECT *
				  FROM (
				  		SELECT rownum rnum, v1.*
						  FROM (
						  		SELECT *
								  FROM user_
								 WHERE gb_del = 'N'
								 ORDER BY user_no
						  		) v1
						 WHERE rownum <![CDATA[ <= ]]> #end#
				  		) v2
				 WHERE rnum <![CDATA[ >= ]]> #start#
				) u
	</select>

	<select id="selectUserCount" resultClass="int">
		SELECT COUNT(*) cnt
		  FROM user_
		WHERE gb_del = 'N'
	</select>
	
	<update id="updateUser" parameterClass="userVO">
		UPDATE user_ 
		SET user_nick = #user_nick# 
			,user_pass = #user_pass#
		 WHERE user_no = #user_no#
	</update>
	
	<update id="deleteUser" parameterClass="int">
		UPDATE user_
		   SET gb_del = 'Y'
		 WHERE user_no = #user_no#
	</update>
	
</sqlMap>